# =============================================================================
# Ansible 配置文件 | Ansible Configuration File
# =============================================================================
# 此文件定义 Ansible 的全局行为和优化设置
# This file defines Ansible's global behavior and optimization settings
# =============================================================================

[defaults]
# -----------------------------------------------------------------------------
# 基础配置 | Basic Configuration
# -----------------------------------------------------------------------------

# 主机清单文件路径 | Inventory file path
inventory = ./inventory/hosts.yml

# Ansible 角色存放目录 | Roles directory path
roles_path = ./roles

# 禁用 SSH 主机密钥检查（首次连接时不提示确认）
# Disable SSH host key checking (no confirmation prompt on first connection)
host_key_checking = False

# 使用 YAML 格式输出，更易读 | Use YAML format output for better readability
stdout_callback = yaml

# 默认远程用户 | Default remote user
remote_user = root

# -----------------------------------------------------------------------------
# 性能优化 | Performance Optimization
# -----------------------------------------------------------------------------

# SSH 连接超时时间（秒）| SSH connection timeout (seconds)
timeout = 30

# 并发执行的主机数量 | Number of parallel host executions
forks = 10

# 智能收集 facts（缓存以提升性能）| Smart facts gathering (cached for performance)
gathering = smart
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
# Facts 缓存超时时间（秒）：86400 = 24小时
# Facts cache timeout (seconds): 86400 = 24 hours
fact_caching_timeout = 86400

# 禁用重试文件生成 | Disable retry files creation
retry_files_enabled = False

# 启用性能分析和计时器 | Enable performance profiling and timer
callbacks_enabled = profile_tasks, timer

# -----------------------------------------------------------------------------
# 权限提升配置 | Privilege Escalation Configuration
# -----------------------------------------------------------------------------
[privilege_escalation]
# 使用 sudo 提升权限 | Use sudo for privilege escalation
become = True
become_method = sudo
become_user = root
become_ask_pass = False

# -----------------------------------------------------------------------------
# SSH 连接优化 | SSH Connection Optimization
# -----------------------------------------------------------------------------
[ssh_connection]
# SSH 连接优化参数 | SSH connection optimization parameters
# - ControlMaster: 复用 SSH 连接 | Reuse SSH connections
# - ControlPersist: 保持连接 60 秒 | Keep connection alive for 60 seconds
# - StrictHostKeyChecking: 不检查主机密钥 | Don't check host keys
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no

# 启用管道传输（减少 SSH 连接数）| Enable pipelining (reduce SSH connections)
pipelining = True

# SSH 控制路径 | SSH control path
control_path = /tmp/ansible-ssh-%%h-%%p-%%r